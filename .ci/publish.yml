parameters:
  directory: ''
  nugetArtifactDirectory: 'output-nuget'
  buildArtifacts: '*Datasync*.dll,*Datasync*.pdb,*.binlog'
  nugetArtifacts: '*.nupkg,*.nuspec'
  

steps:
  - pwsh: |
      New-Item -Force -Path '$(Build.ArtifactStagingDirectory)' -ItemType Directory
      New-Item -Force -Path '$(nugetArtifactDirectory)' -ItemType Directory
    displayName: Create Artifacts Storage

  - pwsh: |
      Copy-Item -Verbose -Path '$(directory)' -Include '$(buildArtifacts)' -Destination '$(Build.ArtifactStagingDirectory)' -Recurse
    displayName: Consolidate build artifacts

  - pwsh: |
      Copy-Item -Verbose -Path '$(directory)' -Include '$(nugetArtifacts)' -Destination '$(nugetArtifactDirectory)' -Recurse
    displayName: Consolidate NuGet artifacts

  - task: PublishBuildArtifacts@1
    displayName: Publish Build Artifacts
    inputs:
      pathToPublish: '$(Build.ArtifactStagingDirectory)'
      artifactName: build

  - task: PublishBuildArtifacts@1
    displayName: Publish NuGet Packages
    inputs:
      PathtoPublish: $(nugetArtifactDirectory)
      artifactName: nuget