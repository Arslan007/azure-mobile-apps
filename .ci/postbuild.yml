parameters:
  sourceDirectory: '.'
  buildArtifactDirectory: '$(Build.ArtifactStagingDirectory)'
  nugetArtifactDirectory: 'output-nuget'
  buildArtifacts: '*Datasync*.dll,*Datasync*.pdb,*.binlog'
  nugetArtifacts: '*.nupkg,*.nuspec'
  
steps:
  - pwsh: |
      Get-ChildItem -Path '${{ parameters.sourceDirectory }}' -Recurse | Write-Host
    displayName: Show Build Artifacts

  - pwsh: |
      New-Item -Force -Path '$(Build.ArtifactStagingDirectory)' -ItemType Directory
      New-Item -Force -Path '${{ parameters.nugetArtifactDirectory }}' -ItemType Directory
    displayName: Create Artifacts Storage

  - pwsh: |
      Copy-Item -Verbose -Path '${{ parameters.sourceDirectory }}' -Include '${{ parameters.buildArtifacts }}' -Destination '${{ parameters.buildArtifactDirectory }}' -Recurse
    displayName: Consolidate build artifacts

  - pwsh: |
      Copy-Item -Verbose -Path '${{ parameters.sourceDirectory }}' -Include '${{ parameters.nugetArtifacts }}' -Destination '${{ parameters.nugetArtifactDirectory }}' -Recurse
    displayName: Consolidate NuGet artifacts

  - task: PublishBuildArtifacts@1
    displayName: Publish Build Artifacts
    inputs:
      pathToPublish: '${{ parameters.buildArtifactDirectory }}'
      artifactName: build

  - task: PublishBuildArtifacts@1
    displayName: Publish NuGet Packages
    inputs:
      PathtoPublish: ${{ parameters.nugetArtifactDirectory }}
      artifactName: nuget